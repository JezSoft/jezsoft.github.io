<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">
  <title>The Passport Companion</title>
  <meta name="description" content="The Passport Companion">
  <meta name="author" content="JezSoft">  
  <style>
      #map {
        height: 100%;
		flex: 1;
      }
	  
	  #menu{
		display:flex;
		flex-direction:column;
		flex: 0 0 300px;
		background-color:#686a6d;
		margin:0px;
		padding:0px;
		overflow-y:scroll;
		overflow-x:hidden;
	  }
	  
	  #menu div{
		cursor:pointer;
		color:#FFF;
	  }
	  
	  #menu div.selected{
		color:#000;
		background-color:#9da0a5;
	  }

      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
	  
	  .fcr{
		height:100%;
		display:flex;		
		flex-direction:row;
	  }
	  
	  .fcc{
		display:flex;
		flex-direction:column;
	  }
    </style>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
</head>
<body>
	<div class=fcr>
		<div id=menu>		
		</div>
		<div id="map">
			
		</div>
	</div>	
	<script>
		var map;
		var markers = [];
		
		$(document).ready(function(){
			$(document).on("click","#menu div",function() {
				var lat = parseFloat($(this).data("lat"));
				var lng = parseFloat($(this).data("lng"));
				var location = {lat: lat, lng: lng};
				map.setCenter(location);
				
				$("#menu div").removeClass("selected");
				$(this).addClass("selected");
			});
		});
		
		function getLoacation(){
			if (navigator.geolocation) {
					navigator.geolocation.getCurrentPosition(function(position) {
					var pos = {
					  lat: position.coords.latitude,
					  lng: position.coords.longitude
					};
					
					var infoWindow = new google.maps.InfoWindow;

					infoWindow.setPosition(pos);
					infoWindow.setContent('Location found.');
					infoWindow.open(map);
					map.setCenter(pos);
				}, function() {
					handleLocationError(true, infoWindow, map.getCenter());
				  });
			} else {
			  // Browser doesn't support Geolocation
			  handleLocationError(false, infoWindow, map.getCenter());
			}
		}
		
		function loadMarkers(){
			$.ajax({
			  type: "GET",
			  dataType: "xml",
			  url: "https://JezSoft.github.io/2017PassportExport.xml",
			  success: function(xml){	
				var polyCoords = [];
				$(xml).find("Placemark").each(function(index){
					var coords = $(this).find("coordinates").text().split(",");
					var myLatLng = {lat: parseFloat(coords[1]), lng: parseFloat(coords[0])};
					
					var name = $(this).find("name").text();
					var infoContent = "<b>" + name + "</b><br>" + $(this).find("description").text();
					
					var infowindow = new google.maps.InfoWindow({
					  content: infoContent
					});
					
					var marker = new google.maps.Marker({
					  position: myLatLng,
					  map: map,
					  title: name
					});
					
					marker.addListener('click', function() {
					  infowindow.open(map, marker);
					});
					
					markers.push(marker);
					
					$("#menu").append('<div data-markerid-"' + marker.closure_uid_930075939 + '" data-lat="' + parseFloat(coords[1]) + '" data-lng="' + parseFloat(coords[0]) + '">' + name + '</div>')
				});				
			  },
			  error: function (status, error){
				alert("error");
			  }
			});
		}
	
		function handleLocationError(browserHasGeolocation, infoWindow, pos) {
			infoWindow.setPosition(pos);
			infoWindow.setContent(browserHasGeolocation ?
								  'Error: The Geolocation service failed.' :
								  'Error: Your browser doesn\'t support geolocation.');
			infoWindow.open(map);				
		}
	  			
		function initMap() {
			map = new google.maps.Map(document.getElementById("map"), {
				  center: {lat: 39.751571, lng: -104.990832},
				  zoom: 15
				});	
			
			loadMarkers();
		}
  </script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCSXYNkU1ea1fq9LK-EC4Bp6GJbV-Dm-OI&callback=initMap"
    async defer></script>
</body>
</html>